<%

    prefix = GlobalConstant::Environment.url_prefix
    wallet_association =  @presenter_obj.sign_messages.wallet_association
    ost_to_fiat =  @presenter_obj.oracle_price_points.to_fiat_conversion_factor("USD")

    bt_symbol = @presenter_obj.client_token.symbol || 'Token'
    chain_id = GlobalConstant::Chain.origin_chain_id

    addresses_api = "/#{prefix}/api/token/addresses"
    deployment_api = "/#{prefix}/api/token/deploy"
    deploy_route = "/#{prefix}/token/deploy"

    #TODO Start : Alpesh check if the above stuff should come from presenter
    conversion_factor = @presenter_obj.client_token.conversion_factor || 1
    bt_to_ost_input_name = "conversion_factor"
    bt_to_ost_min = GlobalConstant::ClientToken.bt_to_ost_min
    bt_to_ost_step = GlobalConstant::ClientToken.bt_to_ost_step
    bt_to_ost_max = GlobalConstant::ClientToken.bt_to_ost_max
    #TODO END : Alpesh check if the above stuff should come from presenter

    bt_to_ost_id = "bt_to_ost"
    ost_to_bt_id = "ost_to_bt_id"

%>
<form data-ost-formhelper id="economy-planner" action="/<%=prefix%>/api/token" method="POST">
  <div class="planner-container  text-center">
    <h3 class="mt-5">
      Welcome to OST KIT, lets set up your token!
    </h3>

  <div class="container">
      <div class="row ">
        <div class="card card-planner my-5">
          <div class="card-header text-left">
            <h4 class="mb-2 ">Token Details</h4>
            <p class="font-weight-light mb-0">
              Here you will set a unique identity for your token. People will relate your brand to your token name and the Token Symbol your act like an identifier
            </p>
          </div>
          <div class="card-body ">
              <div class="user-form row text-left">
                <div class="form-group mb-2 d-inline-block col-3 mr-4">
                  <label class="form-label" for="token_name">Token Name</label>
                  <input type="text" class="form-control" id="name"
                         value ="<%= @presenter_obj.client_token.name%>"
                         placeholder="Token Name" name="name" minlength="4"
                         maxlength="20" pattern="^[a-zA-Z][a-zA-Z0-9\s]+[a-zA-Z0-9\s]+[a-zA-Z0-9]"
                         required tabindex="1" />
                  <div class="invalid-feedback" data-forid="name">&nbps;</div>
                </div>
                <div class="form-group mb-2 d-inline-block col-3">
                  <label class="form-label" for="token_symbol">Token Symbol</label>
                  <input type="text" class="form-control" id="symbol"
                         value ="<%= @presenter_obj.client_token.symbol%>"
                         placeholder="Token Symbol" name="symbol" minlength="3" maxlength="4"
                         pattern="^[a-zA-Z][a-zA-Z0-9]+" required tabindex="1" />
                  <div class="invalid-feedback" data-forid="symbol">&nbps;</div>
                </div>
              </div>
          </div>
        </div>
      </div>
      <div class="row card card-planner mb-5">
        <div class="text-left">
          <div class="card-header">
            <h4 class="mb-0 ">Advance Options</h4>
            <p class="font-weight-light mb-0 mt-2">
              You would be setting Conversion Rate for your token here, simple way to set the conversion rate is by deciding how much you want 1 Token to initially be worth.
              <span class="header-recommendation font-weight-bold">
                Our Recommendation is to set 1 TOKEN = 1 OST = <span class="j-fiat-value"> $<%= ost_to_fiat %> </span>USD</span>
            </p>
          </div>
        </div>
          <div class="accordion" id="advance-options-accordion">
            <div class="text-left">
              <div class="" id="advance-options-header">
                <p class="text-left slider-recommendation m-3 ">
                  Our Recommended conversion rate is set to
                    <span class="text-different-color">1</span>
                       <b> TOKEN  =</b>
                    <span class="text-different-color">1</span>
                       <b> OST =</b>
                    <span class="text-different-color j-fiat-value">$<%= ost_to_fiat %></span>
                       <b>USD</b>
                    <span class="edit-collapse" data-toggle="collapse"
                          data-target="#collapsable-element"
                          aria-expanded="true" aria-controls="collapsable-element">
                     <u><b>EDIT</b></u>
                    </span>
                </p>
              </div>
              <div id="collapsable-element" class="collapse"
                   aria-labelledby="advance-options-header" data-parent="#advance-options-accordion">
                <div class="card-body py-2">
                  <div class="conversion-section user-form">
                    <div class="card-group">
                      <div class="row form-group">
                        <div class="col-4 right-border m-0 card">
                          <label class="form-label mb-2">SET CONVERSION RATE</label>
                          <div class="d-flex align-items-center">
                            <span class="text-different-color mr-2">1</span> OST
                            <span class="equal-to-sign mx-3 font-weight-bold">=</span>
                            <span class="quantity">
                          <input type="number" min="<%=bt_to_ost_min%>" max="<%= bt_to_ost_max %>"
                                 step="<%= bt_to_ost_step%>" id="<%= ost_to_bt_id %>"
                                 name="conversion_factor" value="<%= conversion_factor %>" required>
                        </span>
                          </div>

                        </div>
                        <div class="col-4 right-border m-0 card">
                          <label class="form-label mb-2">AT CURRENT CONVERSION RATE</label>
                          <div class="d-flex align-items-center">
                            <span class="text-different-color mr-2">1</span> BT
                            <span class="equal-to-sign mx-3 font-weight-bold">=</span> $
                            <span class="ost-mocker-value text-different-color j-bt-to-fiat-val"
                                  data-type="fiat"  data-ost-mock-parser="ost.tokenSetup.btToFiat"> <%= ost_to_fiat %>
                                              </span>
                          </div>
                        </div>
                        <div class="col-4 instruction-text">
                          Conversion rate establishes the fixed rate of exchange between your BT and OST. OST is Market linked so the inherent value of your token may fluctuate based on the value of OST
                        </div>
                        <div class="invalid-feedback ml-3" style="font-size: 12px" data-for="conversion_factor" ></div>
                      </div>
                    </div>
                  </div>
                </div>
                </div>
              <div class="invalid-feedback general_error mb-2" data-for="general_error"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

    <footer>
      <div class="row sticky-footer">
        <div class="container">
          <button  type="submit" class="btn btn-steps-nav bg-yellow pt-3 pb-3 float-right"
                   data-submiting="Setting Up..." id="setup-token-btn">Set up your Token &gt;</button>
        </div>
      </div>
      <div class="pseudo-footer"></div>
    </footer>
  </div>
</form>

<% content_for :end_js do %>
  <script type="text/javascript">
      $( function () {
          ost.tokenSetup.init({

              walletAssociation : "<%= wallet_association%>",
              chainId : '<%= chain_id %>',

              addressesEndPoint: '<%= addresses_api%>',
              deploymentEndpoint : '<%=deployment_api %>' ,
              deployRoute : '<%= deploy_route %>',

              ost_to_fiat : '<%= ost_to_fiat %>',
              ostToBtId : "<%= ost_to_bt_id %>"
          });
      });
  </script>
<% end %>
