<% 
  should_show_api_call_button = true;

  fiat_symbol = @presenter_obj.client_fiat_curreny_pref_symbol;
  client_id = @presenter_obj.client_token.client_id;
  auto_create_transactions = !@presenter_obj.client_token.step_two_done?;

  kind_display_text = {
    :user_to_company => "User to Company",
    :user_to_user => "User to User",
    :company_to_user => "Company to User"
  };

%>

<div class="container">
  <div class="row">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center my-4">
        <h3 class="float-left mb-0">Transactions</h3>
        <button id="create_transaction_btn" class="btn btn-gold float-right">ADD TRANSACTIONS</button>
      </div>
    </div>
  </div>
  <table class="transactions">
    <tr class="row">
      <th class="col-2">TRANSACTION</th>
      <th class="col-2">VALUE IN USD</th>
      <th class="col-2">VALUE IN FRC</th>
      <th class="col-2">PRICE ORACLE</th>
      <th class="col-3">COMMISSION %</th>
    </tr>
  </table>
</div>

<div class="container">
  <table id="transaction_list" class="transactions" data-simple-table data-url="/api/economy/transaction/kind/list">
    <script type="text/x-handlebars-template" data-row-template>
      <tr class="row align-items-center py-3 mt-1 mb-3 rounded ost-table-row" style="background-color: #f1f5f8;">
        <td class="col-2">{{name}}<br/>{{kind_display_text}}</td>
        <td class="col-2"><%= fiat_symbol %>{{value_in_fiat}}</td>
        <td class="col-2">{{value_in_bt}}</td>
        <td class="col-2">{{price_oracle_text}}</td>
        <td class="col-1">{{commission_percent}}&#37;</td>
        <td class="col-3">
          {{#IfShowApiCallButton id }}
            <button class="showApiCallBtn btn btn-white">
              <svg class="icon-api">
                <switch>
                  <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#icon-api"></use>
                </switch>
              </svg>API Call</button>
          {{/IfShowApiCallButton}}
          <a href="javascript:void(0)" class="editRow" data-result-id="{{id}}">Edit</a>
          <input type="hidden" name="id" value={{id}}/>
          <input type="hidden" name="uts" value={{uts}}/>
        </td>
      </tr>
    </script>
  </table>
</div>

<% content_for :end_js do %>
  <script type="text/javascript">
    var kindDisplayText = <%= raw kind_display_text.to_json %>;

    Handlebars.registerHelper('price_oracle_text', function(response, options ) {

      var rowData = response.data.root || {};
      return  rowData.currency_type === "bt" ? "No" : "Yes";

    });

    
    Handlebars.registerHelper('kind_display_text', function(response, options ) { 
      var rowData = response.data.root || {}
        , kind    = rowData.kind
      ;

      return kindDisplayText[ kind ];
    });

    Handlebars.registerHelper('value_in_fiat', function(response, options ) { 
        var rowData =  response.data.root || {};
        if ( rowData.currency_type === "bt" ) {
          return PriceOracle.btToFiat( rowData.currency_value );
        } else {
          return PriceOracle.toFiat( rowData.currency_value );
        }
    });

    Handlebars.registerHelper('value_in_bt', function(response, options ) {
        var rowData =  response.data.root || {};
        if ( rowData.currency_type === "bt" ) {

          return PriceOracle.toBt( rowData.currency_value );
        } else {
          return PriceOracle.fiatToBt( rowData.currency_value );
        }
    });


    Handlebars.registerHelper('IfShowApiCallButton', function(data, options ) { 
      if (<%= should_show_api_call_button %>) {
        return options.fn(this);
      } else {
        return options.inverse(this);
      }
    });
    ost.transactions.init({
      auto_create_transactions: <%= auto_create_transactions %>,
      client_id: "<%= client_id %>",
    });  
  </script>
<% end %>