<%
  should_show_api_call_button = true;

  bt_name   = @presenter_obj.client_token.name;
  bt_symbol = @presenter_obj.client_token.symbol;

  tx_status_polling_url = '/api/economy/transaction/fetch-detail';        #fetch transaction details api
  execute_transaction_api = '/api/economy/transaction/execute' ; #Run transaction api
  transaction_history_api = '/api/economy/transaction/history' ;
  long_poll_timeout_millisecond = 500;  #Value needed in milliseconds

  hide_api_call_btn = false
  if @presenter_obj.api_console_data.present?
    api_console_data = @presenter_obj.api_console_data.for_execute_transaction
  else
    hide_api_call_btn = true
  end
  
%>


<style>
  <% # @Thahir/Akshay Please move these styles. to appropriate place %>
  .u-kind-company {
    background-image: url(https://dummyimage.com/100x100/FDA629/FDA629);
    width: 32px;
    height: 32px;
    display: inline-block;
  }
  .u-kind-user {
    background-image: url(https://dummyimage.com/100x100/c4c4c4/c4c4c4);
    width: 32px;
    height: 32px;
    display: inline-block;
  }
</style>

<!--This div should always be present with the details-->

<div class="row ost__planner mb-4">
  <div class="w-100">
    <div class="d-flex justify-content-between align-items-center">
      <h3 class="d-inline-block">Simulator</h3>
      <form id="run-transaction-form" action="<%= execute_transaction_api%>" method="POST" data-ost-formhelper >
        <button type="submit" class="btn btn-gold run-transaction-btn" data-submiting="Running...">run a transaction</button>
        <div class="general_error invalid-feedback" data-forid="run-transaction-form">&nbsp;</div>
      </form>
    </div>
  </div>
</div>


<div class="row ost__planner slider-parent-container" data-slider-content-wrapper=".card" >
  <div id="transaction-history-table" class="col-12" data-simple-table data-url="<%= transaction_history_api %>">
    <script type="text/x-handlebars-template" data-row-template >
      <div class="card row mb-4 ">
        <div class="card-header col-12">
          <div class="d-flex align-items-center justify-content-between p2">
            <div class="w-100">
              <span class="rounded-circle align-middle"></span>
              <span class="align-middle">
                <span class="align-middle">{{txName transaction_type_id}}</span> 

                <span class="align-middle" style="background-color: #9cc5c1;">
                  {{display_bt_transfer_value bt_transfer_value}} <%= bt_symbol %>
                </span>

                From
                <span class="align-middle {{getUserIconClass from_user_id}}"></span>

                <span> {{getUserName from_user_id}}</span>

                To
                <span class="align-middle {{getUserIconClass to_user_id}}"></span>
                <span class="align-middle">{{getUserName to_user_id}} </span>
              </span>
            </div>
            <% if !hide_api_call_btn %>
              <button class="btn btn-white slider-btn">api call</button>
            <% end %>
          </div>
        </div>
        {{#ifTransactionPending status }}
          <div class="pending-transaction-wrapper">
            <span><img src="/ajax-loader.gif" /></span>
            <span>Getting Transaction Details</span>
          </div>
        {{else}}
          <div class="card-body p-4">
            <div class="row mb-0">
              <div class="col-sm-3 pb-2">Tx Hash</div>
              <div class="col-sm-9 pb-2">{{diplay_transaction_hash transaction_hash}}</div>

              
              <div class="col-sm-3 pb-2">Block Number</div>
              <div class="col-sm-9">{{diplay_block_number block_number}}</div>
              

              <div class="col-sm-3 pb-2">Time Stamp</div>
              <div class="col-sm-9 pb-2">{{display_block_timeStamp block_timeStamp}} </div>

              <div class="col-sm-3 pb-2">Transaction Fee</div>
              <div class="col-sm-9 pb-2">{{diplay_transaction_fee transaction_fee}}</div>
            </div>
          </div>
          <% if !hide_api_call_btn %>
          <div class="code-session col-12">
              <!-- comment class="w-100 code-comment"></comment -->
              <code class="w-100 code-line">
                curl -i \
                <br /> -H "Accept: application/json" \
                <br /> -d '<%= api_console_data['request_params'] %>' \
                <br /> -X <%= api_console_data['request_type'] %> <%= api_console_data['request_uri'] %>
              </code>
            </div>
          <% end %>
        {{/ifTransactionPending}}
      </div>
    </script>
  </div>
</div>

<% content_for :end_js do %>
<script type="text/javascript">
  console.log("api_console_data", <%= raw api_console_data.to_json %>);

  $( function () {
    Handlebars.registerHelper('bt_symbol', function(response, options ) {
      return "<%= bt_symbol %>";
    });
  });

</script>
<% end %>


